


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > GameServiceImpl</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">ar.edu.utn.frc.tup.piii.service.impl</a>
</div>

<h1>Coverage Summary for Class: GameServiceImpl (ar.edu.utn.frc.tup.piii.service.impl)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">GameServiceImpl</td>
<td class="coverageStat">
  <span class="percent">
    5,9%
  </span>
  <span class="absValue">
    (1/17)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/58)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    1,3%
  </span>
  <span class="absValue">
    (2/156)
  </span>
</td>
</tr>
  <tr>
    <td class="name">GameServiceImpl$$SpringCGLIB$$0</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    5,9%
  </span>
  <span class="absValue">
    (1/17)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/58)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    1,3%
  </span>
  <span class="absValue">
    (2/156)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package ar.edu.utn.frc.tup.piii.service.impl;
&nbsp;import ar.edu.utn.frc.tup.piii.dtos.bot.AddBotsDto;
&nbsp;import ar.edu.utn.frc.tup.piii.dtos.game.*;
&nbsp;import ar.edu.utn.frc.tup.piii.entities.BotProfileEntity;
&nbsp;import ar.edu.utn.frc.tup.piii.entities.GameEntity;
&nbsp;import ar.edu.utn.frc.tup.piii.entities.PlayerEntity;
&nbsp;import ar.edu.utn.frc.tup.piii.entities.UserEntity;
&nbsp;import ar.edu.utn.frc.tup.piii.exceptions.*;
&nbsp;import ar.edu.utn.frc.tup.piii.mappers.GameMapper;
&nbsp;import ar.edu.utn.frc.tup.piii.model.Game;
&nbsp;import ar.edu.utn.frc.tup.piii.model.Player;
&nbsp;import ar.edu.utn.frc.tup.piii.model.User;
&nbsp;import ar.edu.utn.frc.tup.piii.model.enums.*;
&nbsp;import ar.edu.utn.frc.tup.piii.repository.BotProfileRepository;
&nbsp;import ar.edu.utn.frc.tup.piii.repository.GameRepository;
&nbsp;import ar.edu.utn.frc.tup.piii.repository.PlayerRepository;
&nbsp;import ar.edu.utn.frc.tup.piii.repository.UserRepository;
&nbsp;import ar.edu.utn.frc.tup.piii.service.interfaces.GameService;
&nbsp;import ar.edu.utn.frc.tup.piii.service.interfaces.UserService;
&nbsp;import ar.edu.utn.frc.tup.piii.utils.CodeGenerator;
&nbsp;import ar.edu.utn.frc.tup.piii.utils.ColorManager;
&nbsp;import org.springframework.transaction.annotation.Transactional;
&nbsp;import org.springframework.beans.factory.annotation.Autowired;
&nbsp;import org.springframework.stereotype.Service;
&nbsp;
&nbsp;import java.time.LocalDateTime;
&nbsp;import java.util.Optional;
&nbsp;import java.util.Random;
&nbsp;
&nbsp;@Service
<b class="fc">&nbsp;public class GameServiceImpl implements GameService {</b>
&nbsp;
&nbsp;    @Autowired
&nbsp;    private UserService userService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    private GameRepository gameRepository;
&nbsp;
&nbsp;    @Autowired
&nbsp;    private GameMapper gameMapper;
&nbsp;
&nbsp;    @Autowired
&nbsp;    private UserRepository userRepository;
&nbsp;
&nbsp;    @Autowired
&nbsp;    private PlayerRepository playerRepository;
&nbsp;
&nbsp;    @Autowired
&nbsp;    private BotProfileRepository botProfileRepository;
&nbsp;
&nbsp;    @Autowired
&nbsp;    private CodeGenerator codeGenerator;
&nbsp;
&nbsp;    @Autowired
&nbsp;    private ColorManager colorManager;
&nbsp;
&nbsp;
&nbsp;
<b class="fc">&nbsp;    private Random random = new Random();</b>
&nbsp;
&nbsp;
&nbsp;    @Override
&nbsp;    public Game findById(Long gameId) {
<b class="nc">&nbsp;        return gameRepository.findById(gameId)</b>
<b class="nc">&nbsp;                .map(gameMapper::toModel)</b>
<b class="nc">&nbsp;                .orElseThrow(() -&gt; new GameNotFoundException(&quot;Game not found with id: &quot; + gameId));</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public Optional&lt;Game&gt; findByIdOptional(Long gameId) {
<b class="nc">&nbsp;        return gameRepository.findById(gameId)</b>
<b class="nc">&nbsp;                .map(gameMapper::toModel);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public Game findByGameCode(String gameCode) {
<b class="nc">&nbsp;        return gameRepository.findByGameCode(gameCode)</b>
<b class="nc">&nbsp;                .map(gameMapper::toModel)</b>
<b class="nc">&nbsp;                .orElseThrow(() -&gt; new GameNotFoundException(&quot;Game not found with code: &quot; + gameCode));</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public Game save(Game game) {
<b class="nc">&nbsp;        GameEntity entity = gameMapper.toEntity(game);</b>
<b class="nc">&nbsp;        GameEntity savedEntity = gameRepository.save(entity);</b>
<b class="nc">&nbsp;        return gameMapper.toModel(savedEntity);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean existsById(Long gameId) {
<b class="nc">&nbsp;        return gameRepository.existsById(gameId);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;    @Override
&nbsp;    @Transactional
&nbsp;    public Game createLobbyWithDefaults(Long hostUserId) {
<b class="nc">&nbsp;        UserEntity host = userRepository.findById(hostUserId)</b>
<b class="nc">&nbsp;                .orElseThrow(() -&gt; new UserNotFoundException(&quot;Usuario no encontrado con id: &quot; + hostUserId));</b>
<b class="nc">&nbsp;        String gameCode = codeGenerator.generateUniqueCode();</b>
<b class="nc">&nbsp;        if (gameRepository.existsByGameCode(gameCode)) {</b>
<b class="nc">&nbsp;            throw new InvalidGameConfigurationException(&quot;El c√≥digo generado ya existe: &quot; + gameCode);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        GameEntity gameEntity = new GameEntity();</b>
<b class="nc">&nbsp;        gameEntity.setGameCode(gameCode);</b>
<b class="nc">&nbsp;        gameEntity.setCreatedBy(host);</b>
<b class="nc">&nbsp;        gameEntity.setStatus(GameState.WAITING_FOR_PLAYERS);</b>
&nbsp;
<b class="nc">&nbsp;        gameEntity.setMaxPlayers(6);</b>
<b class="nc">&nbsp;        gameEntity.setTurnTimeLimit(120);</b>
<b class="nc">&nbsp;        gameEntity.setChatEnabled(true);</b>
<b class="nc">&nbsp;        gameEntity.setPactsAllowed(false);</b>
&nbsp;
<b class="nc">&nbsp;        GameEntity savedGame = gameRepository.save(gameEntity);</b>
&nbsp;
<b class="nc">&nbsp;        PlayerEntity hostPlayer = new PlayerEntity();</b>
<b class="nc">&nbsp;        hostPlayer.setUser(host);</b>
<b class="nc">&nbsp;        hostPlayer.setGame(savedGame);</b>
<b class="nc">&nbsp;        hostPlayer.setColor(PlayerColor.RED);</b>
<b class="nc">&nbsp;        hostPlayer.setStatus(PlayerStatus.WAITING);</b>
<b class="nc">&nbsp;        hostPlayer.setSeatOrder(1); // primer asiento</b>
<b class="nc">&nbsp;        playerRepository.save(hostPlayer);</b>
&nbsp;
<b class="nc">&nbsp;        return gameMapper.toModel(savedGame);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    @Override
&nbsp;    @Transactional(readOnly = true)
&nbsp;    public GameResponseDto getGameByCode(String gameCode) {
&nbsp;
<b class="nc">&nbsp;        GameEntity gameEntity = gameRepository.findByGameCode(gameCode)</b>
<b class="nc">&nbsp;                .orElseThrow(() -&gt; new GameNotFoundException(&quot;Game not found with code: &quot; + gameCode));</b>
<b class="nc">&nbsp;        return gameMapper.toResponseDto(gameEntity);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    @Transactional
&nbsp;    @Override
&nbsp;    public Game joinGame(JoinGameDto dto) {
<b class="nc">&nbsp;        GameEntity gameEntity = gameRepository.findByGameCode(dto.getGameCode())</b>
<b class="nc">&nbsp;                .orElseThrow(() -&gt; new GameNotFoundException(&quot;Game not found with code: &quot; + dto.getGameCode()));</b>
&nbsp;
<b class="nc">&nbsp;        if (gameEntity.getStatus() != GameState.WAITING_FOR_PLAYERS) {</b>
<b class="nc">&nbsp;            throw new InvalidGameStateException(&quot;Game is not accepting new players. Current state: &quot; + gameEntity.getStatus());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        UserEntity user = userRepository.findById(dto.getUserId())</b>
<b class="nc">&nbsp;                .orElseThrow(() -&gt; new UserNotFoundException(&quot;User not found with id: &quot; + dto.getUserId()));</b>
&nbsp;
<b class="nc">&nbsp;        Optional&lt;PlayerEntity&gt; existingPlayerOpt = gameEntity.getPlayers().stream()</b>
<b class="nc">&nbsp;                .filter(p -&gt; p.getUser() != null &amp;&amp; p.getUser().getId().equals(dto.getUserId()))</b>
<b class="nc">&nbsp;                .findFirst();</b>
&nbsp;
<b class="nc">&nbsp;        if (existingPlayerOpt.isPresent()) {</b>
<b class="nc">&nbsp;            PlayerEntity existingPlayer = existingPlayerOpt.get();</b>
&nbsp;
<b class="nc">&nbsp;            if (existingPlayer.getStatus() != PlayerStatus.ELIMINATED) {</b>
<b class="nc">&nbsp;                throw new InvalidGameStateException(&quot;User is already in this game.&quot;);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                throw new InvalidGameStateException(&quot;User was already eliminated from this game.&quot;);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        long activePlayers = gameEntity.getPlayers().stream()</b>
<b class="nc">&nbsp;                .filter(p -&gt; p.getStatus() != PlayerStatus.ELIMINATED)</b>
<b class="nc">&nbsp;                .count();</b>
&nbsp;
<b class="nc">&nbsp;        if (activePlayers &gt;= gameEntity.getMaxPlayers()) {</b>
<b class="nc">&nbsp;            throw new GameFullException(&quot;Game is full. Max players: &quot; + gameEntity.getMaxPlayers());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        PlayerColor availableColor = colorManager.getAvailableRandomColor(gameEntity);</b>
<b class="nc">&nbsp;        if (availableColor == null) {</b>
<b class="nc">&nbsp;            throw new ColorNotAvailableException(&quot;No colors available&quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        PlayerEntity newPlayer = new PlayerEntity();</b>
<b class="nc">&nbsp;        newPlayer.setUser(user);</b>
<b class="nc">&nbsp;        newPlayer.setGame(gameEntity);</b>
<b class="nc">&nbsp;        newPlayer.setColor(availableColor);</b>
<b class="nc">&nbsp;        newPlayer.setStatus(PlayerStatus.WAITING);</b>
<b class="nc">&nbsp;        newPlayer.setSeatOrder(gameEntity.getPlayers().size() + 1);  // cuidado: no reordena huecos</b>
&nbsp;
<b class="nc">&nbsp;        playerRepository.save(newPlayer);</b>
&nbsp;
<b class="nc">&nbsp;        return gameMapper.toModel(gameEntity);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    @Transactional
&nbsp;    @Override
&nbsp;    public Game addBotsToGame(AddBotsDto dto) {
<b class="nc">&nbsp;        GameEntity gameEntity = gameRepository.findByGameCode(dto.getGameCode())</b>
<b class="nc">&nbsp;                .orElseThrow(() -&gt; new GameNotFoundException(&quot;Game not found with code: &quot; + dto.getGameCode()));</b>
<b class="nc">&nbsp;        if (gameEntity.getStatus() != GameState.WAITING_FOR_PLAYERS) {</b>
<b class="nc">&nbsp;            throw new InvalidGameStateException(&quot;Cannot add bots. Game state: &quot; + gameEntity.getStatus());</b>
&nbsp;        }
<b class="nc">&nbsp;        int currentPlayers = gameEntity.getPlayers().size();</b>
<b class="nc">&nbsp;        int requestedBots = 1;</b>
&nbsp;
<b class="nc">&nbsp;        if (currentPlayers + requestedBots &gt; gameEntity.getMaxPlayers()) {</b>
<b class="nc">&nbsp;            throw new GameFullException(&quot;Not enough space. Current: &quot; + currentPlayers +</b>
<b class="nc">&nbsp;                    &quot;, Requested bots: &quot; + requestedBots + &quot;, Max: &quot; + gameEntity.getMaxPlayers());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        BotProfileEntity botProfile = botProfileRepository.findByLevelAndStrategy(</b>
<b class="nc">&nbsp;                        dto.getBotLevel(), dto.getBotStrategy())</b>
<b class="nc">&nbsp;                .orElse(createDefaultBotProfile(dto.getBotLevel(), dto.getBotStrategy()));</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; requestedBots; i++) {</b>
<b class="nc">&nbsp;            PlayerColor availableColorBot = colorManager.getAvailableRandomColor(gameEntity);</b>
<b class="nc">&nbsp;            if (availableColorBot == null) {</b>
&nbsp;                break;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            PlayerEntity botPlayer = new PlayerEntity();</b>
<b class="nc">&nbsp;            botPlayer.setBotProfile(botProfile);</b>
<b class="nc">&nbsp;            botPlayer.setGame(gameEntity);</b>
<b class="nc">&nbsp;            botPlayer.setColor(availableColorBot);</b>
<b class="nc">&nbsp;            botPlayer.setStatus(PlayerStatus.WAITING);</b>
<b class="nc">&nbsp;            botPlayer.setSeatOrder(currentPlayers + i + 1);</b>
&nbsp;
<b class="nc">&nbsp;            playerRepository.save(botPlayer);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return gameMapper.toModel(gameEntity);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    @Transactional
&nbsp;    @Override
&nbsp;    public Game startGame(String gameCode) {
&nbsp;
<b class="nc">&nbsp;        GameEntity gameEntity = gameRepository.findByGameCode(gameCode)</b>
<b class="nc">&nbsp;                .orElseThrow(() -&gt; new GameNotFoundException(&quot;Game not found with code: &quot; + gameCode));</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;        if (gameEntity.getStatus() != GameState.WAITING_FOR_PLAYERS) {</b>
<b class="nc">&nbsp;            throw new InvalidGameStateException(&quot;Cannot start game. Current state: &quot; + gameEntity.getStatus());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        int playerCount = gameEntity.getPlayers().size();</b>
<b class="nc">&nbsp;        if (playerCount &lt; 2) {</b>
<b class="nc">&nbsp;            throw new InvalidGameStateException(&quot;Minimum 2 players required to start. Current: &quot; + playerCount);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        gameEntity.setStatus(GameState.IN_PROGRESS);</b>
<b class="nc">&nbsp;        gameEntity.setStartedAt(java.time.LocalDateTime.now());</b>
<b class="nc">&nbsp;        gameEntity.setCurrentTurn(1);</b>
<b class="nc">&nbsp;        gameEntity.setCurrentPlayerIndex(0);</b>
<b class="nc">&nbsp;        gameEntity.getPlayers().forEach(player -&gt;</b>
<b class="nc">&nbsp;                player.setStatus(PlayerStatus.ACTIVE));</b>
&nbsp;
&nbsp;        //  Guardar cambios
<b class="nc">&nbsp;        GameEntity savedGame = gameRepository.save(gameEntity);</b>
&nbsp;
&nbsp;        //TODO: Inicializar territorios y cartas (implementar despu√©s)
&nbsp;        // initializeTerritories(savedGame);
&nbsp;        // initializeCards(savedGame);
&nbsp;
&nbsp;        //TODO: Activar StateMachine (implementar despu√©s)
&nbsp;        // stateMachineService.startGame(savedGame.getId());
&nbsp;
<b class="nc">&nbsp;        return gameMapper.toModel(savedGame);</b>
&nbsp;    }
&nbsp;    private BotProfileEntity createDefaultBotProfile(BotLevel level, BotStrategy strategy) {
<b class="nc">&nbsp;        BotProfileEntity botProfile = new BotProfileEntity();</b>
<b class="nc">&nbsp;        botProfile.setBotName(&quot;Bot &quot; + level.name());</b>
<b class="nc">&nbsp;        botProfile.setLevel(level);</b>
<b class="nc">&nbsp;        botProfile.setStrategy(strategy);</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;        return botProfileRepository.save(botProfile);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;    @Transactional
&nbsp;    @Override
&nbsp;    public Game updateGameSettings(String gameCode, UpdateGameSettingsDto dto) {
&nbsp;
<b class="nc">&nbsp;        GameEntity gameEntity = gameRepository.findForSettings(gameCode)</b>
<b class="nc">&nbsp;                .orElseThrow(() -&gt; new GameNotFoundException(&quot;Game not found with code: &quot; + gameCode));</b>
&nbsp;
<b class="nc">&nbsp;        if (gameEntity.getStatus() != GameState.WAITING_FOR_PLAYERS) {</b>
<b class="nc">&nbsp;            throw new InvalidGameStateException(&quot;Cannot modify settings once game has started&quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (!gameEntity.getCreatedBy().getId().equals(dto.getRequesterId())) {</b>
<b class="nc">&nbsp;            throw new ForbiddenException(&quot;Only the host can modify game settings&quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (dto.getMaxPlayers() != null) {</b>
<b class="nc">&nbsp;            if (dto.getMaxPlayers() &lt; 2 || dto.getMaxPlayers() &gt; 6) {</b>
<b class="nc">&nbsp;                throw new InvalidGameConfigurationException(&quot;Max players must be between 2 and 6&quot;);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            int currentPlayerCount = gameEntity.getPlayers().size();</b>
<b class="nc">&nbsp;            if (dto.getMaxPlayers() &lt; currentPlayerCount) {</b>
<b class="nc">&nbsp;                throw new InvalidGameConfigurationException(&quot;Cannot set max players below current player count: &quot; + currentPlayerCount);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (dto.getTurnTimeLimit() != null &amp;&amp; dto.getTurnTimeLimit() &lt;= 0) {</b>
<b class="nc">&nbsp;            throw new InvalidGameConfigurationException(&quot;Turn time limit must be greater than 0&quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (dto.getMaxPlayers() != null) {</b>
<b class="nc">&nbsp;            gameEntity.setMaxPlayers(dto.getMaxPlayers());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (dto.getTurnTimeLimit() != null) {</b>
<b class="nc">&nbsp;            gameEntity.setTurnTimeLimit(dto.getTurnTimeLimit());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (dto.getChatEnabled() != null) {</b>
<b class="nc">&nbsp;            gameEntity.setChatEnabled(dto.getChatEnabled());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (dto.getPactsAllowed() != null) {</b>
<b class="nc">&nbsp;            gameEntity.setPactsAllowed(dto.getPactsAllowed());</b>
&nbsp;        }
<b class="nc">&nbsp;        GameEntity savedGame = gameRepository.save(gameEntity);</b>
<b class="nc">&nbsp;        return gameMapper.toModel(savedGame);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    @Transactional
&nbsp;    public Game kickPlayer(KickPlayerDto dto)
&nbsp;            throws GameNotFoundException, PlayerNotFoundException, InvalidGameStateException, ForbiddenException {
&nbsp;
<b class="nc">&nbsp;        GameEntity gameEntity = gameRepository.findByGameCode(dto.getGameCode())</b>
<b class="nc">&nbsp;                .orElseThrow(() -&gt;</b>
<b class="nc">&nbsp;                        new GameNotFoundException(&quot;Game not found with code: &quot; + dto.getGameCode())</b>
&nbsp;                );
&nbsp;
<b class="nc">&nbsp;        if (gameEntity.getStatus() != GameState.WAITING_FOR_PLAYERS) {</b>
<b class="nc">&nbsp;            throw new InvalidGameStateException(</b>
&nbsp;                    &quot;Cannot kick player. Game is not in WAITING_FOR_PLAYERS state. Current: &quot;
<b class="nc">&nbsp;                            + gameEntity.getStatus()</b>
&nbsp;            );
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        PlayerEntity playerEntity = playerRepository.findByGameAndUserId(gameEntity, dto.getPlayerId())</b>
<b class="nc">&nbsp;                .orElseThrow(() -&gt;</b>
<b class="nc">&nbsp;                        new PlayerNotFoundException(</b>
<b class="nc">&nbsp;                                &quot;Player with id &quot; + dto.getPlayerId() +</b>
<b class="nc">&nbsp;                                        &quot; not found in game &quot; + dto.getGameCode()</b>
&nbsp;                        )
&nbsp;                );
&nbsp;
<b class="nc">&nbsp;        UserEntity hostUser = gameEntity.getCreatedBy();</b>
<b class="nc">&nbsp;        if (hostUser.getId().equals(playerEntity.getUser().getId())) {</b>
<b class="nc">&nbsp;            throw new ForbiddenException(&quot;Cannot kick the host of the game&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (playerEntity.getBotProfile()!=null) {</b>
<b class="nc">&nbsp;            playerRepository.delete(playerEntity);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            playerEntity.setStatus(PlayerStatus.ELIMINATED);</b>
<b class="nc">&nbsp;            playerEntity.setEliminatedAt(LocalDateTime.now());</b>
<b class="nc">&nbsp;            playerRepository.save(playerEntity);</b>
&nbsp;        }
&nbsp;
&nbsp;
&nbsp;        //al eliminar un jugador no se reasigna el orden del juego por lo que el orden del juego
&nbsp;        //va a tener el mismo que antes
&nbsp;        //problemas para mi yo del futuro
<b class="nc">&nbsp;        return gameMapper.toModel(gameEntity);</b>
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-06-03 23:42</div>
</div>
</body>
</html>
